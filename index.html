<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dutroux Sellüî•</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header"><h1>Dutroux Sell üî•</h1></div>
  <div class="divider-horizontal"></div>
  <div class="category-marquee">
    <div class="category-track">
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
    </div>
  </div>

  <div class="tab-content">
    <!-- –ö–ê–¢–ê–õ–û–ì -->
    <div id="catalog" class="tab-pane active">
      <div class="catalog-header"><div class="bar"></div><div class="title">–¢–æ–≤–∞—Ä—ã</div></div>

      <!-- –¢–û–í–ê–†–´ -->
      <div class="product-card" data-name="–ü—Ä–µ–≤—å—é" data-price="200" data-image="preview.png" data-desc="–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞">
        <img src="preview.png" alt="Preview">
        <div class="product-info">
          <div class="product-title">–ü—Ä–µ–≤—å—é</div>
          <div class="product-description">–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</div>
          <div class="product-price">200 ‚ÇΩ</div>
          <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          <div class="reviews">
            <div class="review">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ!</div>
            <div class="review">–ê–Ω–æ–Ω–∏–º: –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é.</div>
          </div>
        </div>
      </div>

      <div class="product-card" data-name="–ü—Ä–∏–≤–∞—Ç–∫–∞" data-price="300" data-image="privatka.png" data-desc="–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤">
        <img src="privatka.png" alt="–ü—Ä–∏–≤–∞—Ç–∫–∞">
        <div class="product-info">
          <div class="product-title">–ü—Ä–∏–≤–∞—Ç–∫–∞</div>
          <div class="product-description">–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
          <div class="product-price">300 ‚ÇΩ</div>
          <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          <div class="reviews">
            <div class="review">–ö–ª–∏–µ–Ω—Ç: –ö–æ–Ω—Ç–µ–Ω—Ç üî•, —Å–ø–∞—Å–∏–±–æ!</div>
            <div class="review">–ê–ø–æ–Ω: –í—Å—ë —á—ë—Ç–∫–æ, –ø–æ–ª—É—á–∏–ª —Å—Ä–∞–∑—É!</div>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <img id="modal-img" src="" alt="">
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <div class="modal-price" id="modal-price"></div>
        <button id="modal-add">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    </div>

    <!-- –ö–û–†–ó–ò–ù–ê -->
    <div id="cart" class="tab-pane">
      <div class="cart-header">
        <button class="back-btn" onclick="goToTab('catalog')">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="title">–ö–æ—Ä–∑–∏–Ω–∞</div>
        <div class="total" id="total">0,00 ‚ÇΩ</div>
      </div>
      <div class="cart-body" id="cart-body">–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã.</div>
      <button class="checkout-btn" id="checkout-btn" style="display: none;">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
    </div>

    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div id="profile" class="tab-pane">
      <div class="profile-info">
        <img src="avatar.png" alt="Avatar" id="user-avatar">
        <div>
          <strong id="user-name">–ò–º—è –§–∞–º–∏–ª–∏—è</strong><br>
          <span id="user-username">@username</span><br>
          ID: <span id="user-id">123456</span>
        </div>
      </div>
      <div class="separator"></div>
      <div class="balance-card styled-card">
        <div>–ë–∞–ª–∞–Ω—Å: <strong>0,00 ‚ÇΩ</strong></div>
        <button>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
      </div>
      <div class="separator"></div>
      <div class="promocode-card styled-card">
        <div>–ü—Ä–æ–º–æ–∫–æ–¥:</div>
        <input type="text" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
        <button id="promo-btn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        <div id="promo-message" class="promo-error"></div>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <button class="active" data-tab="catalog"><img src="home.svg" alt=""><span>–ö–∞—Ç–∞–ª–æ–≥</span></button>
    <button data-tab="cart"><img src="cart.svg" alt=""><span>–ö–æ—Ä–∑–∏–Ω–∞</span></button>
    <button data-tab="profile"><img src="profile.svg" alt=""><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>

  <script>
  const navButtons = document.querySelectorAll('.bottom-nav button');
  const tabs = document.querySelectorAll('.tab-pane');
  const totalText = document.getElementById('total');
  const cartBody = document.getElementById('cart-body');
  const modal = document.getElementById('modal');
  const checkoutBtn = document.getElementById('checkout-btn');
  const balanceCard = document.querySelector('.balance-card strong');
  const balanceBtn = document.querySelector('.balance-card button');
  let cart = {}, total = 0;
  let userBalance = 0;

  function goToTab(id) {
    navButtons.forEach(b => b.classList.remove('active'));
    tabs.forEach(t => t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelector(`[data-tab="${id}"]`)?.classList.add('active');
  }

  document.querySelectorAll('.add-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const card = btn.closest('.product-card');
      addToCart(card.dataset.name, +card.dataset.price, card.dataset.image);
    });
  });

  document.querySelectorAll('.details-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const card = btn.closest('.product-card');
      document.getElementById('modal-img').src = card.dataset.image;
      document.getElementById('modal-title').textContent = card.dataset.name;
      document.getElementById('modal-desc').textContent = card.dataset.desc;
      document.getElementById('modal-price').textContent = card.dataset.price + ' ‚ÇΩ';
      modal.classList.remove('hidden');
      document.getElementById('modal-add').onclick = () => {
        addToCart(card.dataset.name, +card.dataset.price, card.dataset.image);
        modal.classList.add('hidden');
      };
    });
  });

  document.querySelector('.close-btn').onclick = () => modal.classList.add('hidden');
  window.onclick = e => { if (e.target === modal) modal.classList.add('hidden'); };

  function updateCartDisplay() {
    cartBody.innerHTML = '';
    if (!Object.keys(cart).length) {
      cartBody.textContent = '–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã.';
      totalText.textContent = '0,00 ‚ÇΩ';
      checkoutBtn.style.display = 'none';
      return;
    }

    Object.values(cart).forEach(item => {
      let div = document.createElement('div');
      div.className = 'product-card';
      div.innerHTML = `
        <img src="${item.image}" alt=""><div class="product-info">
          <div class="product-title">${item.name}</div>
          <div class="product-price">${item.price} ‚ÇΩ √ó ${item.count}</div>
          <div class="cart-controls">
            <button onclick="decrementItem('${item.name}')">‚àí</button>
            <button onclick="incrementItem('${item.name}')">+</button>
          </div>
        </div>`;
      cartBody.appendChild(div);
    });
    totalText.textContent = total.toFixed(2) + ' ‚ÇΩ';
    checkoutBtn.style.display = 'block';
  }

  function addToCart(name, price, image) {
    if (!cart[name]) cart[name] = { name, price, image, count: 0 };
    cart[name].count++;
    total += price;
    updateCartDisplay();
  }

  function incrementItem(name) {
    cart[name].count++;
    total += cart[name].price;
    updateCartDisplay();
  }

  function decrementItem(name) {
    if (!cart[name]) return;
    cart[name].count--;
    total -= cart[name].price;
    if (cart[name].count <= 0) delete cart[name];
    updateCartDisplay();
  }

  navButtons.forEach(btn => btn.addEventListener('click', () => goToTab(btn.dataset.tab)));

  // –ü–†–û–ú–û–ö–û–î
  document.getElementById('promo-btn').onclick = () => {
    const message = document.getElementById('promo-message');
    message.textContent = '–¢–∞–∫–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
    message.style.color = 'red';
  };

  // –ü–û–ü–û–õ–ù–ï–ù–ò–ï –ë–ê–õ–ê–ù–°–ê
  balanceBtn.onclick = () => {
    alert(`–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞:\n\n` +
      `1) –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –ª—é–±—É—é —Å—É–º–º—É –Ω–∞ –æ–¥–Ω—É –∏–∑ –∫–∞—Ä—Ç:\n` +
      `–¢-–±–∞–Ω–∫: 2200701969378618\n` +
      `–°–±–µ—Ä–±–∞–Ω–∫: 2202208282306746\n\n` +
      `2) –í Telegram –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –õ–° @Velik09845 –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã.\n` +
      `3) –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.`);
  };

  // –û–ü–õ–ê–¢–ê –ó–ê–ö–ê–ó–ê (–∫–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é")
  checkoutBtn.onclick = async () => {
    if (total === 0) return;

    if (userBalance >= total) {
      // –û–ø–ª–∞—Ç–∞ –±–∞–ª–∞–Ω—Å–æ–º
      if (!confirm(`–û–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É ${total.toFixed(2)} ‚ÇΩ —Å –±–∞–ª–∞–Ω—Å–∞ (${userBalance.toFixed(2)} ‚ÇΩ)?`)) return;

      userBalance -= total;
      balanceCard.textContent = userBalance.toFixed(2) + ' ‚ÇΩ';
      alert('–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —Å –±–∞–ª–∞–Ω—Å–∞! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É.');

      // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
      cart = {};
      total = 0;
      updateCartDisplay();

      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –æ —Å–ø–∏—Å–∞–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

    } else {
      // –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ YooKassa (—Å–æ–∑–¥–∞—ë–º –ø–ª–∞—Ç–µ–∂)
      if (!window.Telegram || !window.Telegram.WebApp) {
        alert('–û—à–∏–±–∫–∞: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
        return;
      }

      const user = Telegram.WebApp.initDataUnsafe?.user || {};
      const firstProduct = Object.values(cart)[0];
      if (!firstProduct) return;

      try {
        const response = await fetch('/create-payment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: user.id,
            username: user.username || 'unknown',
            product: firstProduct.name,
          }),
        });

        const data = await response.json();
        if (data.confirmation_url) {
          window.open(data.confirmation_url, '_blank');
        } else {
          alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
        }
      } catch (e) {
        alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
      }
    }
  };

  // –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ò–ó TELEGRAM –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–õ–ê–ù–°–ê
  window.addEventListener('DOMContentLoaded', () => {
    if (window.Telegram.WebApp) {
      Telegram.WebApp.ready();
      const user = Telegram.WebApp.initDataUnsafe?.user;

      if (user) {
        document.getElementById('user-name').textContent = `${user.first_name} ${user.last_name || ''}`.trim();
        document.getElementById('user-username').textContent = user.username ? `@${user.username}` : '–±–µ–∑ –Ω–∏–∫–∞';
        document.getElementById('user-id').textContent = user.id;

        if (user.username) {
          document.getElementById('user-avatar').src = `https://t.me/i/userpic/320/${user.username}.jpg`;
        }
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä 0 (–º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞)
    userBalance = 0;
    balanceCard.textContent = userBalance.toFixed(2) + ' ‚ÇΩ';

    updateCartDisplay();
  });
</script>
