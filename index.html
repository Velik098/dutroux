<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dutroux Sellüî•</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal.hidden {
      display: none;
    }
    .modal-content {
      background: #1e1e1e;
      color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      max-width: 400px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      font-family: 'Arial', sans-serif;
      position: relative;
    }
    .modal-content h2, .modal-content h3 {
      margin-top: 0;
      color: #ffcc00;
    }
    .modal-content button {
      background-color: #ffcc00;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .modal-content button:hover {
      background-color: #e6b800;
    }
    .modal-content input, .modal-content textarea {
      background: #2e2e2e;
      border: 1px solid #555;
      color: #fff;
      padding: 8px;
      border-radius: 6px;
      width: 100%;
    }
    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #fff;
    }
    #orderModal ul {
      padding-left: 20px;
    }
    .review-item {
      margin-top: 10px;
      border-top: 1px dashed #444;
      padding-top: 8px;
      font-size: 14px;
    }
    .review-author {
      color: #ffcc00;
      font-weight: bold;
    }
    #reviews-container h3 {
      text-align: center;
      margin-top: 25px;
      margin-bottom: 10px;
    }
    #submitReview {
      margin-top: 10px;
      display: block;
      width: 100%;
      text-align: center;
    }
    #reviewInput {
      margin-top: 10px;
      resize: vertical;
    }
    #splash-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #0a0f2c, #1d3b72); /* –°–∏–Ω–∏–µ —Ç–æ–Ω–∞ */
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 99999;
  transition: opacity 0.6s ease;
}

#splash-screen.fade-out {
  opacity: 0;
  pointer-events: none;
}

.splash-content {
  text-align: center;
  animation: splash-fade 1.5s ease-in-out infinite;
}

.splash-logo {
  width: 90px;
  height: 90px;
  margin-bottom: 20px;
  border-radius: 16px;
  box-shadow: 0 0 25px rgba(0, 174, 255, 0.5);
  animation: pulse 1.2s ease-in-out infinite;
}

.splash-title {
  color: #cce8ff;
  font-family: 'Arial', sans-serif;
  font-size: 22px;
  font-weight: 500;
  text-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.9; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes splash-fade {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.85; }
}

.splash-content {
  text-align: center;
  animation: splash-fade 1.5s ease-in-out infinite;
}

.splash-logo {
  width: 90px;
  height: 90px;
  margin-bottom: 20px;
  border-radius: 16px;
  box-shadow: 0 0 25px rgba(0, 174, 255, 0.5);
  animation: pulse 1.2s ease-in-out infinite;
}

.splash-title {
  color: #cce8ff;
  font-family: 'Arial', sans-serif;
  font-size: 22px;
  font-weight: 500;
  text-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.9; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes splash-fade {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.85; }
}
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

  <div class="header" style="display: flex; align-items: center; gap: 12px; padding: 10px 16px;">
  <img src="logo.png" alt="Logo" style="height: 40px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.3);">
  <h1 style="font-size: 24px; color: #fff; font-family: 'Arial', sans-serif;">Dutroux Sell üî•</h1>
</div>
  <div class="divider-horizontal"></div>

  <!-- –ë–µ–≥—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
  <div class="category-marquee">
    <div class="category-track">
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ üî•</button>
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ üî•</button>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->

  <div class="tab-content">
    <!-- –ö–ê–¢–ê–õ–û–ì -->
    <!-- –ö–ê–¢–ê–õ–û–ì -->
<div id="catalog" class="tab-pane active">
  <div class="catalog-header">
    <div class="bar"></div>
    <div class="title">–¢–æ–≤–∞—Ä—ã</div>
  </div>

  <!-- –¢–û–í–ê–†–´ -->
  <div class="product-card" data-name="–ü—Ä–µ–≤—å—é" data-price="200" data-image="preview.png" data-desc="–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞">
    <img src="preview.png" alt="Preview">
    <div class="product-info">
      <div class="product-title">–ü—Ä–µ–≤—å—é</div>
      <div class="product-description">–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</div>
      <div class="product-price">200 ‚ÇΩ</div>
      <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
      <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

  <div class="product-card" data-name="–ü—Ä–∏–≤–∞—Ç–∫–∞" data-price="300" data-image="privatka.png" data-desc="–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤">
    <img src="privatka.png" alt="–ü—Ä–∏–≤–∞—Ç–∫–∞">
    <div class="product-info">
      <div class="product-title">–ü—Ä–∏–≤–∞—Ç–∫–∞</div>
      <div class="product-description">–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
      <div class="product-price">300 ‚ÇΩ</div>
      <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
      <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

  <!-- üÜï –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞ -->
  <div class="product-card" data-name="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞" data-price="500" data-image="yt-design.png" data-desc="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ YouTube-–∫–∞–Ω–∞–ª–∞ (–±–∞–Ω–Ω–µ—Ä, –∞–≤–∞—Ç–∞—Ä, —Å—Ç–∏–ª—å)">
    <img src="yt-design.png" alt="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞">
    <div class="product-info">
      <div class="product-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞</div>
      <div class="product-description">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ YouTube-–∫–∞–Ω–∞–ª–∞ (–±–∞–Ω–Ω–µ—Ä, –∞–≤–∞—Ç–∞—Ä, —Å—Ç–∏–ª—å)</div>
      <div class="product-price">500 ‚ÇΩ</div>
      <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
      <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

  <!-- üÜï –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä: 2 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 1 -->
  <div class="product-card" data-name="3 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 2" data-price="400" data-image="2for1.png" data-desc="–ü–æ–ª—É—á–∏—Ç–µ —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ –¥–≤—É—Ö ‚Äî –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!">
    <img src="2for1.png" alt="3 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 2">
    <div class="product-info">
      <div class="product-title">3 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 2</div>
      <div class="product-description">–ü–æ–ª—É—á–∏—Ç–µ —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ –¥–≤—É—Ö ‚Äî –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!</div>
      <div class="product-price">400 ‚ÇΩ</div>
      <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
      <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>

</div> <!-- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ #catalog -->

    <!-- –ú–û–î–ê–õ–ö–ê "–ü–û–î–†–û–ë–ù–ï–ï" -->
    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-btn" id="detailsCloseBtn">&times;</span>
        <img id="modal-img" src="" alt="" style="max-width: 100%; border-radius: 8px; margin-bottom: 10px;">
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <div class="modal-price" id="modal-price"></div>
        <button id="modal-add">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>

        <div id="reviews-container">
          <h3>–û—Ç–∑—ã–≤—ã:</h3>
          <div id="modal-reviews"></div>
          <textarea id="reviewInput" rows="3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤..."></textarea>
          <button id="submitReview">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </div>
      </div>
    </div>

    <!-- –ö–û–†–ó–ò–ù–ê -->
    <div id="cart" class="tab-pane">
      <div class="cart-header">
        <button class="back-btn" onclick="goToTab('catalog')">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="title">–ö–æ—Ä–∑–∏–Ω–∞</div>
        <div class="total" id="total">0,00 ‚ÇΩ</div>
      </div>
      <div class="cart-body" id="cart-body">–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã.</div>
      <button class="checkout-btn" id="checkout-btn" style="display: none;">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
    </div>

    <!-- –ü–†–û–§–ò–õ–¨ -->
<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<div id="profile" class="tab-pane">
  <div class="profile-card styled-card">
    <div class="profile-header" style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
  <div style="flex-shrink: 0;">
    <div style="position: relative; width: 70px; height: 70px; cursor: pointer;" onclick="document.getElementById('avatarModal').classList.remove('hidden')">
  <img id="user-avatar" src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" alt="Avatar"
       style="width: 70px; height: 70px; border-radius: 50%; object-fit: cover; box-shadow: 0 0 10px rgba(0,0,0,0.4);" />
  <img src="https://cdn-icons-png.flaticon.com/512/84/84380.png" alt="Edit" title="–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"
       style="position: absolute; bottom: -2px; right: -2px; width: 20px; height: 20px; background: #fff; border-radius: 50%; padding: 2px;" />
  </div>
  </div>
  <div style="text-align: right;">
   <div style="text-align: right;">
    <div id="profile-username" style="font-size: 18px; font-weight: bold;">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
    <div id="profile-tg" style="font-size: 14px; color: #ccc;">@username</div>
    <div id="profile-id" style="font-size: 14px; color: #888;">ID: 123456</div>
  </div>
  </div>
</div>
  </div>

  <!-- –ë–ê–õ–ê–ù–° -->
  <div class="balance-card styled-card">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>–í–∞—à –±–∞–ª–∞–Ω—Å:</div>
    <div id="balance-amount" style="font-weight: bold; font-size: 18px;">0 ‚ÇΩ</div>
  </div>
  <button id="topup-btn" style="margin-top: 10px;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
</div>

  <hr style="margin: 18px 0; border-color: #333;">
  
  <!-- –ü–†–û–ú–û–ö–û–î -->
  <div class="promocode-card styled-card">
    <div>–ü—Ä–æ–º–æ–∫–æ–¥:</div>
    <input type="text" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" style="width: 95%; box-sizing: border-box; margin-top: 8px;">
    <button id="promo-btn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    <div id="promo-message" class="promo-error"></div>
  </div>
  
  <hr style="margin: 18px 0; border-color: #333;">

<!-- –ü–†–û–®–õ–´–ï –ó–ê–ö–ê–ó–´ -->
<div class="orders-card styled-card">
  <div style="font-weight: bold; margin-bottom: 10px;">–ü—Ä–æ—à–ª—ã–µ –∑–∞–∫–∞–∑—ã:</div>
  <div id="order-history">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–∫–∞–∑—ã...</div>
</div>
</div>

  <div id="avatarModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn" onclick="document.getElementById('avatarModal').classList.add('hidden')">&times;</span>
    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</h3>
    <p>–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π (1000x1000 PNG/JPG):</p>
    <input type="file" id="avatarUpload" accept="image/png, image/jpeg" />
    <hr style="margin: 15px 0;">
    <p>–ò–ª–∏ –≤—ã–±—Ä–∞—Ç—å –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö:</p>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
      <img src="blue.png" class="preset-avatar" alt="blue" width="60">
      <img src="green.png" class="preset-avatar" alt="green" width="60">
      <img src="purple.png" class="preset-avatar" alt="purple" width="60">
      <img src="red.png" class="preset-avatar" alt="red" width="60">
    </div>
  </div>
</div>

  <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
  <div class="bottom-nav">
    <button class="active" data-tab="catalog"><img src="home.svg" alt=""><span>–ö–∞—Ç–∞–ª–æ–≥</span></button>
    <button data-tab="cart"><img src="cart.svg" alt=""><span>–ö–æ—Ä–∑–∏–Ω–∞</span></button>
    <button data-tab="profile"><img src="profile.svg" alt=""><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>
    
    <!-- –ú–û–î–ê–õ–ö–ê –í–í–û–î–ê USERNAME -->
  <div id="usernameModal" class="modal hidden">
    <div class="modal-content">
      <span id="usernameCloseBtn" class="close-btn">&times;</span>
      <h3>–£–∫–∞–∂–∏—Ç–µ –≤–∞—à Telegram username</h3>
      <p>–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –≤–∞—à –ø–ª–∞—Ç—ë–∂ –∏ –≤—ã—Å–ª–∞—Ç—å —Ç–æ–≤–∞—Ä.</p>
      <input type="text" id="tgUsernameInput" placeholder="@username" style="width: 100%; margin-top: 10px;">
      <div style="margin-top: 15px;">
        <button id="submitUsername">–û–ö</button>
      </div>
    </div>
  </div>

<script>
const toast = document.createElement('div');
toast.id = 'toast';
toast.style.position = 'fixed';
toast.style.bottom = '20px';
toast.style.right = '20px';
toast.style.background = '#333';
toast.style.color = '#fff';
toast.style.padding = '12px 20px';
toast.style.borderRadius = '10px';
toast.style.opacity = '0';
toast.style.transition = 'opacity 0.4s ease';
toast.style.zIndex = '9999';
toast.style.fontFamily = 'Arial, sans-serif';
toast.style.pointerEvents = 'none';
document.body.appendChild(toast);

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ ‚Äî —Å—Ç–∏–ª–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è (–º–æ–∂–Ω–æ –≤ CSS, –Ω–æ –ª—É—á—à–µ —Ç—É—Ç —Å—Ä–∞–∑—É)
const style = document.createElement('style');
style.textContent = `
  #toast.show {
    opacity: 1 !important;
  }
`;
document.head.appendChild(style);

document.addEventListener("DOMContentLoaded", function () {
  const navButtons = document.querySelectorAll('.bottom-nav button');
  const tabs = document.querySelectorAll('.tab-pane');
  const totalText = document.getElementById('total');
  const cartBody = document.getElementById('cart-body');
  const modal = document.getElementById('modal');
  const checkoutBtn = document.getElementById('checkout-btn');
  const modalReviews = document.getElementById('modal-reviews');
  const reviewInput = document.getElementById('reviewInput');
  const submitReview = document.getElementById('submitReview');

  let currentProduct = "";
  let telegramUser = null;
  let cart = {}, total = 0;

  const style = document.createElement('style');
  style.innerHTML = `
    .tab-pane {
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .tab-pane.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .pulse-animate {
      animation: pulse 0.4s ease;
    }
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      color: #fff;
      padding: 14px 24px;
      border-radius: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 9999;
      font-family: Arial, sans-serif;
      font-size: 16px;
    }
    #toast.show {
      opacity: 1;
    }
  `;
  document.head.appendChild(style);

  const toast = document.createElement('div');
  toast.id = 'toast';
  document.body.appendChild(toast);

  function goToTab(id) {
    tabs.forEach(t => t.classList.remove('active'));
    document.getElementById(id)?.classList.add('active');

    navButtons.forEach(b => b.classList.remove('active'));
    document.querySelector(`[data-tab="${id}"]`)?.classList.add('active');
  }

  function showToast(message) {
    toast.textContent = message;
    toast.classList.add('show');
    clearTimeout(toast._timeout);
    toast._timeout = setTimeout(() => {
      toast.classList.remove('show');
    }, 2500);
  }

  function addToCart(name, price, image) {
    if (!cart[name]) cart[name] = { name, price, image, count: 0 };
    cart[name].count++;
    total += price;
    updateCartDisplay();
    showToast(`üõí ¬´${name}¬ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
  }

  function updateCartDisplay() {
    cartBody.innerHTML = '';
    if (!Object.keys(cart).length) {
      cartBody.textContent = '–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã.';
      totalText.textContent = '0,00 ‚ÇΩ';
      checkoutBtn.style.display = 'none';
      return;
    }

    Object.values(cart).forEach(item => {
      let div = document.createElement('div');
      div.className = 'product-card';
      div.innerHTML = `
        <img src="${item.image}" alt="">
        <div class="product-info">
          <div class="product-title">${item.name}</div>
          <div class="product-price">${item.price} ‚ÇΩ √ó ${item.count}</div>
          <div class="cart-controls">
            <button onclick="decrementItem('${item.name}')">‚àí</button>
            <button onclick="incrementItem('${item.name}')">+</button>
          </div>
        </div>
      `;
      cartBody.appendChild(div);
    });

    totalText.textContent = total.toFixed(2) + ' ‚ÇΩ';
    checkoutBtn.style.display = 'block';
  }

  window.incrementItem = function(name) {
    cart[name].count++;
    total += cart[name].price;
    updateCartDisplay();
  };

  window.decrementItem = function(name) {
    if (!cart[name]) return;
    cart[name].count--;
    total -= cart[name].price;
    if (cart[name].count <= 0) delete cart[name];
    updateCartDisplay();
  };

  navButtons.forEach(btn => btn.addEventListener('click', () => goToTab(btn.dataset.tab)));

  document.querySelectorAll('.add-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const card = btn.closest('.product-card');
      addToCart(card.dataset.name, +card.dataset.price, card.dataset.image);

      btn.disabled = true;
      const originalText = btn.textContent;
      btn.textContent = "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!";
      btn.style.backgroundColor = "#4CAF50";
      btn.classList.add("pulse-animate");

      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.backgroundColor = "";
        btn.classList.remove("pulse-animate");
        btn.disabled = false;
      }, 1500);
    });
  });

  document.querySelectorAll('.details-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const card = btn.closest('.product-card');
      document.getElementById('modal-img').src = card.dataset.image;
      document.getElementById('modal-title').textContent = card.dataset.name;
      document.getElementById('modal-desc').textContent = card.dataset.desc;
      document.getElementById('modal-price').textContent = card.dataset.price + ' ‚ÇΩ';
      modal.classList.remove('hidden');

      currentProduct = card.dataset.name;
      loadReviews();

      document.getElementById('modal-add').onclick = () => {
        addToCart(card.dataset.name, +card.dataset.price, card.dataset.image);
        modal.classList.add('hidden');
      };
    });
  });

  document.getElementById('detailsCloseBtn').onclick = () => modal.classList.add('hidden');

  window.onclick = e => {
    if (e.target === modal) modal.classList.add('hidden');
    if (e.target === document.getElementById('orderModal')) document.getElementById('orderModal').classList.add('hidden');
    if (e.target === document.getElementById('usernameModal')) document.getElementById('usernameModal').classList.add('hidden');
  };

  document.getElementById('promo-btn').onclick = () => {
    const message = document.getElementById('promo-message');
    message.textContent = '–¢–∞–∫–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
    message.style.color = 'red';
  };

  document.getElementById('orderCloseBtn').onclick = () => document.getElementById('orderModal').classList.add('hidden');
  document.getElementById('orderCloseButton').onclick = () => document.getElementById('orderModal').classList.add('hidden');

  document.getElementById('paidButton').onclick = () => {
    const orderId = 'ORD-' + Math.random().toString(36).substr(2, 8).toUpperCase();
    const orderDate = new Date().toLocaleString('ru-RU');
    const order = {
      id: orderId,
      date: orderDate,
      total: total.toFixed(2),
      items: Object.values(cart).map(item => `${item.name} √ó ${item.count}`)
    };

    const orders = JSON.parse(localStorage.getItem('orderHistory') || '[]');
    orders.push(order);
    localStorage.setItem('orderHistory', JSON.stringify(orders));

    document.getElementById('orderModal').classList.add('hidden');
    document.getElementById('usernameModal').classList.remove('hidden');

    cart = {};
    total = 0;
    updateCartDisplay();
    loadOrders();
  };

  document.getElementById('usernameCloseBtn').onclick = () => document.getElementById('usernameModal').classList.add('hidden');

  document.getElementById('submitUsername').onclick = () => {
    const username = document.getElementById('tgUsernameInput').value.trim();
    if (!username || !username.startsWith('@')) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π username Telegram, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å "@"');
      return;
    }
    document.getElementById('usernameModal').classList.add('hidden');
    alert('–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–∫–æ—Ä–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ–º—Å—è –≤ Telegram.');
  };

  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.ready();
    telegramUser = Telegram.WebApp.initDataUnsafe?.user;

    if (telegramUser) {
      const fullName = `${telegramUser.first_name} ${(telegramUser.last_name || '').trim()}`;
      document.getElementById('profile-username').textContent = fullName;
      document.getElementById('profile-id').textContent = `ID: ${telegramUser.id}`;

      if (telegramUser.username) {
        document.getElementById('profile-tg').textContent = `@${telegramUser.username}`;
        document.getElementById('user-avatar').src = `https://t.me/i/userpic/320/${telegramUser.username}.jpg`;
      } else {
        document.getElementById('profile-tg').textContent = '@–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
      }
    }
  }

  function loadReviews() {
    const key = `reviews_${currentProduct}`;
    const reviews = JSON.parse(localStorage.getItem(key) || '[]');
    modalReviews.innerHTML = '';
    if (!reviews.length) {
      modalReviews.innerHTML = '<p>–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
    } else {
      reviews.forEach(r => {
        const div = document.createElement('div');
        div.className = 'review-item';
        div.innerHTML = `<span class="review-author">${r.name}</span>: ${r.text}`;
        modalReviews.appendChild(div);
      });
    }
  }

  submitReview.onclick = () => {
    const text = reviewInput.value.trim();
    if (!text) return alert('–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤!');
    const name = telegramUser
      ? `${telegramUser.first_name} ${(telegramUser.last_name || '').trim()}`
      : '–ê–Ω–æ–Ω–∏–º';

    const key = `reviews_${currentProduct}`;
    const reviews = JSON.parse(localStorage.getItem(key) || '[]');
    reviews.push({ name, text });
    localStorage.setItem(key, JSON.stringify(reviews));
    reviewInput.value = '';
    loadReviews();
  };

  document.getElementById('edit-avatar-btn')?.addEventListener('click', () => {
    document.getElementById('avatarModal').classList.remove('hidden');
  });

  document.querySelectorAll('.preset-avatar').forEach(img => {
    img.onclick = () => {
      const src = img.getAttribute('src');
      localStorage.setItem('customAvatar', src);
      document.getElementById('user-avatar').src = src;
      document.getElementById('avatarModal').classList.add('hidden');
    };
  });

  document.getElementById('avatarUpload')?.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      localStorage.setItem('customAvatar', e.target.result);
      document.getElementById('user-avatar').src = e.target.result;
      document.getElementById('avatarModal').classList.add('hidden');
    };
    reader.readAsDataURL(file);
  });

  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
      modal.classList.add('hidden');
    }
  });

  document.getElementById('topup-btn').onclick = () => {
    alert('–î–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ @Velik09845');
  };

  function loadOrders() {
    const historyContainer = document.getElementById('order-history');
    const orders = JSON.parse(localStorage.getItem('orderHistory') || '[]');

    if (!orders.length) {
      historyContainer.innerHTML = '<p style="color: #888;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>';
      return;
    }

    historyContainer.innerHTML = '';
    orders.reverse().forEach(order => {
      const div = document.createElement('div');
      div.className = 'order-entry';
      div.innerHTML = `
        <div><strong>–ö–æ–¥ –∑–∞–∫–∞–∑–∞:</strong> ${order.id}</div>
        <div><strong>–î–∞—Ç–∞:</strong> ${order.date}</div>
        <div><strong>–°—É–º–º–∞:</strong> ${order.total} ‚ÇΩ</div>
        <div><strong>–¢–æ–≤–∞—Ä—ã:</strong> ${order.items.join(', ')}</div>
        <hr style="border-color: #333; margin: 10px 0;">
      `;
      historyContainer.appendChild(div);
    });
  }

  updateCartDisplay();
  loadOrders();

  const savedAvatar = localStorage.getItem('customAvatar');
  if (savedAvatar) {
    document.getElementById('user-avatar').src = savedAvatar;
  }

  // ‚úÖ FIXED: Checkout button now works properly
  if (checkoutBtn) {
    checkoutBtn.onclick = () => {
      if (total === 0) return;

      document.getElementById('paymentTotal').textContent = total.toFixed(2) + ' ‚ÇΩ';

      const container = document.getElementById('paymentItems');
      container.innerHTML = '';
      Object.values(cart).forEach(item => {
        const div = document.createElement('div');
        div.style.marginBottom = '6px';
        div.innerHTML = `<strong>${item.name}</strong> √ó ${item.count}`;
        container.appendChild(div);
      });

      document.getElementById('paymentPromoInput').value = '';
      document.getElementById('paymentPromoMessage').textContent = '';

      document.getElementById('paymentModal').classList.remove('hidden');
    };
  }

  document.getElementById('paymentPromoBtn').onclick = () => {
    const promo = document.getElementById('paymentPromoInput').value.trim();
    const message = document.getElementById('paymentPromoMessage');

    if (promo === 'DUTROUX10') {
      total = total * 0.9;
      document.getElementById('paymentTotal').textContent = total.toFixed(2) + ' ‚ÇΩ';
      message.textContent = '–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω: —Å–∫–∏–¥–∫–∞ 10%';
      message.style.color = '#00ffcc';
    } else {
      message.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥';
      message.style.color = 'red';
    }
  };

  document.getElementById('payButton').onclick = () => {
    alert("–¢—É—Ç –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ ‚Äî —Ä–µ–∞–ª–∏–∑—É–µ—à—å —Å–∞–º üòâ");
  };
});
</script>

  </div>
</div>
