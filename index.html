<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dutroux Sellüî•</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal.hidden { display: none; }
    .modal-content {
      background: #1e1e1e; color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      max-width: 400px; width: 90%;
      font-family: 'Arial', sans-serif;
      position: relative;
    }
    .modal-content h2, .modal-content h3 { margin-top: 0; color: #ffcc00; }
    .modal-content button {
      background-color: #ffcc00;
      color: #000; border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .modal-content button:hover { background-color: #e6b800; }
    .modal-content input {
      background: #2e2e2e;
      border: 1px solid #555;
      color: #fff;
      padding: 8px;
      border-radius: 6px;
    }
    .close-btn {
      position: absolute;
      top: 10px; right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: #fff;
    }
    #orderModal ul { padding-left: 20px; }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="header"><h1>Dutroux Sell üî•</h1></div>
  <div class="divider-horizontal"></div>

  <!-- –ë–µ–≥—É—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
  <div class="category-marquee">
    <div class="category-track">
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="tab-content">
    <!-- –ö–ê–¢–ê–õ–û–ì -->
    <div id="catalog" class="tab-pane active">
      <div class="catalog-header">
        <div class="bar"></div>
        <div class="title">–¢–æ–≤–∞—Ä—ã</div>
      </div>

      <!-- –¢–û–í–ê–†–´ -->
      <div class="product-card" data-name="–ü—Ä–µ–≤—å—é" data-price="200" data-image="preview.png" data-desc="–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞">
        <img src="preview.png" alt="Preview">
        <div class="product-info">
          <div class="product-title">–ü—Ä–µ–≤—å—é</div>
          <div class="product-description">–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</div>
          <div class="product-price">200 ‚ÇΩ</div>
          <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          <div class="reviews">
            <div class="review">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ!</div>
            <div class="review">–ê–Ω–æ–Ω–∏–º: –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é.</div>
          </div>
        </div>
      </div>

      <div class="product-card" data-name="–ü—Ä–∏–≤–∞—Ç–∫–∞" data-price="300" data-image="privatka.png" data-desc="–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤">
        <img src="privatka.png" alt="–ü—Ä–∏–≤–∞—Ç–∫–∞">
        <div class="product-info">
          <div class="product-title">–ü—Ä–∏–≤–∞—Ç–∫–∞</div>
          <div class="product-description">–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
          <div class="product-price">300 ‚ÇΩ</div>
          <button class="details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          <div class="reviews">
            <div class="review">–ö–ª–∏–µ–Ω—Ç: –ö–æ–Ω—Ç–µ–Ω—Ç üî•, —Å–ø–∞—Å–∏–±–æ!</div>
            <div class="review">–ê–ø–æ–Ω: –í—Å—ë —á—ë—Ç–∫–æ, –ø–æ–ª—É—á–∏–ª —Å—Ä–∞–∑—É!</div>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê "–ü–û–î–†–û–ë–ù–ï–ï" -->
    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-btn" id="detailsCloseBtn">&times;</span>
        <img id="modal-img" src="" alt="" style="max-width: 100%; border-radius: 8px; margin-bottom: 10px;">
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <div class="modal-price" id="modal-price"></div>
        <button id="modal-add">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    </div>
   <!-- –ö–û–†–ó–ò–ù–ê -->
    <div id="cart" class="tab-pane">
      <div class="catalog-header">
        <div class="bar"></div>
        <div class="title">–ö–æ—Ä–∑–∏–Ω–∞</div>
      </div>
      <div id="cart-body"></div>
      <div class="cart-footer">
        <div id="total">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
        <button id="checkout-btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
      </div>
    </div>

    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div id="profile" class="tab-pane">
      <div class="catalog-header">
        <div class="bar"></div>
        <div class="title">–ü—Ä–æ—Ñ–∏–ª—å</div>
      </div>
      <div class="profile-info">
        <p id="user-name">–ò–º—è: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</p>
        <p id="user-username">Username: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</p>
        <p id="user-id">ID: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</p>
      </div>
    </div>
  </div>

  <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
  <div class="bottom-nav">
    <button data-tab="catalog" class="active">–ö–∞—Ç–∞–ª–æ–≥</button>
    <button data-tab="cart">–ö–æ—Ä–∑–∏–Ω–∞</button>
    <button data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –û–§–û–†–ú–õ–ï–ù–ò–Ø -->
  <div id="orderModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-btn" id="orderCloseBtn">&times;</span>
      <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
      <h3>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: <span id="orderAmount">0 ‚ÇΩ</span></h3>
      <ul id="orderItemsList"></ul>
      <button id="paidButton">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
      <button id="orderCloseButton">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –í–í–û–î–ê USERNAME -->
  <div id="usernameModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-btn" id="usernameCloseBtn">&times;</span>
      <h2>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram username</h2>
      <input type="text" id="tgUsernameInput" placeholder="@username">
      <button id="submitUsername">–û–ö</button>
    </div>
  </div>
 <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const tabs = document.querySelectorAll(".bottom-nav button");
    const panes = document.querySelectorAll(".tab-pane");

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        tabs.forEach((t) => t.classList.remove("active"));
        tab.classList.add("active");

        panes.forEach((pane) => pane.classList.remove("active"));
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });

    // === –û–ë–†–ê–ë–û–¢–ö–ê –û–ü–õ–ê–¢–´ ===
    document.getElementById("checkout-btn").addEventListener("click", () => {
      const cartItems = JSON.parse(localStorage.getItem("cart") || "[]");
      if (cartItems.length === 0) return;

      document.getElementById("orderItemsList").innerHTML = "";
      let total = 0;
      cartItems.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - ${item.price} ‚ÇΩ`;
        document.getElementById("orderItemsList").appendChild(li);
        total += item.price;
      });

      document.getElementById("orderAmount").textContent = `${total} ‚ÇΩ`;
      document.getElementById("orderModal").classList.remove("hidden");
    });

    document.getElementById("paidButton").addEventListener("click", () => {
      document.getElementById("orderModal").classList.add("hidden");
      document.getElementById("usernameModal").classList.remove("hidden");
    });

    document.getElementById("submitUsername").addEventListener("click", async () => {
      const username = document.getElementById("tgUsernameInput").value.trim().replace(/^@/, "");
      if (!username) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π username!");

      try {
        const res = await fetch(`/paid/${username}`);
        const msg = await res.text();
        alert(msg);
        document.getElementById("usernameModal").classList.add("hidden");
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
      }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–æ–Ω
    document.getElementById("orderCloseBtn").onclick =
      document.getElementById("orderCloseButton").onclick = () => {
        document.getElementById("orderModal").classList.add("hidden");
      };
    document.getElementById("usernameCloseBtn").onclick = () => {
      document.getElementById("usernameModal").classList.add("hidden");
    };

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    window.addEventListener("load", () => {
      const user = tg.initDataUnsafe.user;
      document.getElementById("user-name").textContent = `–ò–º—è: ${user?.first_name || "–Ω–µ—Ç"}`;
      document.getElementById("user-username").textContent = `Username: @${user?.username || "–Ω–µ—Ç"}`;
      document.getElementById("user-id").textContent = `ID: ${user?.id || "–Ω–µ—Ç"}`;
    });
  </script>
</body>
</html>
