<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dutroux Sellüî•</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg-1: #07060a;
      --bg-2: #0f1724;
      --neon-yellow: #ffd800;
      --neon-red: #ff385c;
      --neon-cyan: #00d4ff;
      --muted: rgba(255,255,255,0.6);
      --header-h: 72px;
      --bottom-nav-h: 92px;
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; }
    body{
      margin:0;
      min-height:100vh;
      font-family:"Poppins", "Montserrat", system-ui, Arial, sans-serif;
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(0,212,255,0.035), transparent 8%),
        radial-gradient(900px 500px at 90% 90%, rgba(186,255,0,0.02), transparent 8%),
        linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#eaf6ff;
      -webkit-font-smoothing:antialiased;
      padding:0;
      overflow-x:hidden;
    }

    .header{
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px 16px;
      position:relative;
      z-index:30;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.03);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      height: var(--header-h);
      min-height: 56px;

      /* CENTER the logo and title */
      justify-content: center;
    }
    .header-inner{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .header img{height:44px;border-radius:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
    .header h1{
      font-size:18px;
      margin:0;
      line-height:1;
      letter-spacing:0.2px;
      color:var(--neon-cyan);
      font-weight:700;
      text-align:center;
    }

    .divider-horizontal{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.03), transparent);
      margin: 6px 0 8px 0;
    }

    .category-marquee{ overflow:hidden; padding:8px 0; border-top:1px solid rgba(255,255,255,0.02); border-bottom:1px solid rgba(255,255,255,0.02); background: linear-gradient(90deg, rgba(0,0,0,0.12), transparent); position:relative; z-index:20; }
    .category-track{ display:flex; gap:12px; animation: marquee 14s linear infinite; padding-left:6px; }
    @keyframes marquee{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
    .category{ border:1px solid rgba(255,255,255,0.06); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); color: #fff; padding:8px 12px; border-radius:999px; font-weight:600; font-size:13px; cursor:pointer; box-shadow: 0 6px 18px rgba(0,0,0,0.6); transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease; }
    .category:hover{ transform: translateY(-3px); border-color: rgba(186,255,0,0.9); box-shadow: 0 10px 30px rgba(186,255,0,0.06); }

    .tab-content{ padding:12px 14px; height: calc(100vh - var(--header-h) - 24px); overflow-y: auto; -webkit-overflow-scrolling: touch; overscroll-behavior-y: contain; padding-bottom: calc(var(--bottom-nav-h) + 20px); display: block; }

    .catalog-header{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .catalog-header .bar{ width:4px;height:28px;border-radius:4px; background: linear-gradient(180deg,var(--neon-cyan),var(--neon-yellow)); box-shadow: 0 6px 20px rgba(0,212,255,0.06); }
    .catalog-header .title{ font-weight:700; font-size:18px; color:#fff; }

    .product-card{ display:flex; gap:10px; align-items:flex-start; padding:10px; margin-bottom:12px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border: 1px solid rgba(255,255,255,0.03); transition: transform .22s cubic-bezier(.2,.9,.2,1), box-shadow .22s ease, border-color .22s ease; position:relative; overflow:hidden; align-items:center; }
    .product-card img{ width:84px; height:84px; object-fit:cover; border-radius:10px; flex-shrink:0; box-shadow: 0 8px 30px rgba(0,0,0,0.6); background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15)); }
    #catalog .product-card:hover{ transform: translateY(-6px); border-color: rgba(186,255,0,0.7); }

    .product-info{ flex:1; min-width:0; display:flex; flex-direction:column; }
    .product-title{ font-weight:700; font-size:16px; color:#fff; margin-bottom:6px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; }
    .product-description{ color:var(--muted); font-size:13px; margin-bottom:8px; display:block; }
    .product-price{ color:var(--neon-yellow); font-weight:700; font-size:14px; display:inline-block; }

    /* Buttons: —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã */
    .btn {
      margin-top:10px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:10px;
      border:none;
      font-weight:700;
      cursor:pointer;
      transition: transform .14s ease, box-shadow .14s ease;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }
    .btn-outline {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
      color:#cfefff;
      border:1px solid rgba(255,255,255,0.04);
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--neon-yellow), var(--neon-red));
      color:#000;
      border: none;
    }
    .btn-accent {
      background: linear-gradient(90deg, #0b5fff, #0077ff);
      color:#fff;
      border: none;
    }
    .btn-small { padding:6px 10px; border-radius:8px; font-weight:700; font-size:13px; }

    .modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.7)); z-index:1200; padding:20px; }
    .modal.hidden{ display:none; }
    .modal-content{ width:100%; max-width:520px; background: linear-gradient(180deg, rgba(9,14,24,0.96), rgba(6,8,12,0.96)); border-radius:16px; padding:18px; color:#eaf6ff; box-shadow: 0 20px 60px rgba(0,0,0,0.7); border:1px solid rgba(255,255,255,0.03); position:relative; }
    .modal-content h2, .modal-content h3{ margin-top:0; color:var(--neon-yellow); }
    .modal-content button{ cursor:pointer; }
    .modal-content input, .modal-content textarea{ background:#0f1724; border:1px solid rgba(255,255,255,0.04); color:#eaf6ff; padding:10px; border-radius:10px; width:100%; outline:none; }

    .close-btn{ position:absolute; top:12px; right:14px; font-size:22px; color:#fff; opacity:0.95; cursor:pointer; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); width:36px;height:36px;border-radius:10px; display:flex;align-items:center;justify-content:center; border:1px solid rgba(255,255,255,0.03); }

    .styled-card{ background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.03); padding:12px;border-radius:12px;margin-bottom:12px; color: #eaf6ff; }

    .bottom-nav{ position:fixed; left:12px;right:12px;bottom:12px; height:64px; display:flex; align-items:center; justify-content:space-around; gap:8px; background: linear-gradient(180deg, rgba(8,10,20,0.95), rgba(6,8,12,0.95)); border-radius:18px; padding:6px 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.7); border:1px solid rgba(255,255,255,0.03); z-index:9999; }
    .bottom-nav button{ background:transparent;border:0;color:var(--neon-yellow);font-weight:700; display:flex;flex-direction:column;align-items:center;gap:4px;font-size:12px;cursor:pointer; padding:6px 8px; border-radius:10px; }
    .bottom-nav button.active, .bottom-nav button:hover{ color:var(--neon-red); transform:translateY(-2px); background: rgba(255,255,255,0.01); }

    .cart-header{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:6px 4px 12px 4px;}
    .cart-body{ padding:8px 4px; color:var(--muted); min-height:80px; display:flex; flex-direction:column; gap:8px; align-items:stretch; }

    .back-btn{ background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff;padding:6px 10px;border-radius:10px;cursor:pointer }
    .checkout-btn{ display:inline-block;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--neon-yellow),var(--neon-red));border:none;color:#000;font-weight:800;cursor:pointer }

    .promo-error{ margin-top:8px; color: #ffdddd; font-weight:700; }

    /* ===== Promo input styling (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ) ===== */
    .promocode-card input#promo-input {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
      border: 1px solid rgba(255,255,255,0.04);
      color: #eaf6ff;
      padding: 10px;
      border-radius: 10px;
      width: 100%;
      outline: none;
      transition: box-shadow .12s ease, transform .08s ease;
    }
    .promocode-card input#promo-input:focus {
      box-shadow: 0 8px 30px rgba(0,212,255,0.06);
      transform: translateY(-2px);
    }
    /* ================================================= */

    /* Topup modal specific */
    .topup-presets { display:flex; gap:8px; margin-top:8px; }
    .preset-btn {
      flex:1;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      cursor:pointer;
      font-weight:700;
      text-align:center;
    }
    .preset-btn.active { border-color: rgba(255,215,0,0.9); box-shadow: 0 8px 30px rgba(255,215,0,0.06); transform:translateY(-2px); }

    .topup-footer { display:flex; gap:8px; margin-top:14px; }
    .topup-amount-input { font-size:18px; font-weight:700; padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:#07101a; color:#eaf6ff; width:100%; text-align:center; }

    @media (min-width:720px){ .modal-content{ max-width:640px; } .product-card{ gap:14px; padding:14px } .product-card img{ width:110px; height:110px; border-radius:12px; } :root { --bottom-nav-h: 80px; } }
    @media (max-width:420px){ .header h1{ font-size:16px } .category{ padding:7px 10px; font-size:12px } .bottom-nav{ height:72px; left:8px; right:8px; bottom:8px; border-radius:14px;} :root { --bottom-nav-h: 110px; } }

    .tab-pane { opacity: 0; transform: translateY(6px); pointer-events: none; transition: opacity .18s ease, transform .18s ease; display: none; }
    .tab-pane.active { opacity: 1; transform: translateY(0); pointer-events: auto; display: block; }

    #toast{ border-radius:12px; padding:12px 18px; font-weight:600; letter-spacing:0.2px; box-shadow: 0 12px 30px rgba(0,0,0,0.6); position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:99999; opacity:0; transition:opacity .25s ease; background: rgba(0,0,0,0.85); color: #fff; }
    #toast.show{ opacity:1; pointer-events:auto; }

    /* disabled confirm topup */
    .btn.disabled, .btn[disabled] {
      opacity: 0.55;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    /* Centered small title for topup modal */
    .topup-title {
      font-size: 15px;
      font-weight: 700;
      text-align: center;
      color: #fff;
      margin: 0 0 6px 0;
    }
    .topup-subtitle {
      font-size: 13px;
      text-align: center;
      color: var(--muted);
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

  <div class="header" id="appHeader">
    <div class="header-inner">
      <img src="logo.png" alt="Logo" id="logoImg" style="height: 40px; border-radius: 12px;">
      <h1 id="appTitle">Dutroux Sell üî•</h1>
    </div>
  </div>
  <div class="divider-horizontal"></div>

  <div class="category-marquee">
    <div class="category-track">
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ üî•</button>
      <button class="category">–ü—Ä–∏–≤–∞—Ç–∫–∞ üí∏</button>
      <button class="category">–ü—Ä–µ–≤—å—é üöÄ</button>
      <button class="category">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ üî•</button>
    </div>
  </div>

  <div class="tab-content" id="tabContent">
    <div id="catalog" class="tab-pane active">
      <div class="catalog-header">
        <div class="bar"></div>
        <div class="title">–¢–æ–≤–∞—Ä—ã</div>
      </div>

      <div class="product-card" data-name="–ü—Ä–µ–≤—å—é" data-price="200" data-image="preview.png" data-desc="–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞">
        <img src="preview.png" alt="Preview">
        <div class="product-info">
          <div class="product-title">–ü—Ä–µ–≤—å—é</div>
          <div class="product-description">–ö—Ä–∞—Å–æ—á–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –í–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</div>
          <div class="product-price">200 ‚ÇΩ</div>
          <div style="margin-top:auto">
            <button class="btn btn-outline details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button class="btn btn-primary add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>
      </div>

      <div class="product-card" data-name="–ü—Ä–∏–≤–∞—Ç–∫–∞" data-price="300" data-image="privatka.png" data-desc="–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤">
        <img src="privatka.png" alt="–ü—Ä–∏–≤–∞—Ç–∫–∞">
        <div class="product-info">
          <div class="product-title">–ü—Ä–∏–≤–∞—Ç–∫–∞</div>
          <div class="product-description">–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</div>
          <div class="product-price">300 ‚ÇΩ</div>
          <div style="margin-top:auto">
            <button class="btn btn-outline details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button class="btn btn-primary add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>
      </div>

      <div class="product-card" data-name="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞" data-price="500" data-image="yt-design.png" data-desc="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ YouTube-–∫–∞–Ω–∞–ª–∞ (–±–∞–Ω–Ω–µ—Ä, –∞–≤–∞—Ç–∞—Ä, —Å—Ç–∏–ª—å)">
        <img src="yt-design.png" alt="–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞">
        <div class="product-info">
          <div class="product-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è YT –∫–∞–Ω–∞–ª–∞</div>
          <div class="product-description">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ YouTube-–∫–∞–Ω–∞–ª–∞ (–±–∞–Ω–Ω–µ—Ä, –∞–≤–∞—Ç–∞—Ä, —Å—Ç–∏–ª—å)</div>
          <div class="product-price">500 ‚ÇΩ</div>
          <div style="margin-top:auto">
            <button class="btn btn-outline details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button class="btn btn-primary add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>
      </div>

      <div class="product-card" data-name="3 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 2" data-price="400" data-image="2for1.png" data-desc="–ü–æ–ª—É—á–∏—Ç–µ —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ –¥–≤—É—Ö ‚Äî –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!">
        <img src="2for1.png" alt="3 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 2">
        <div class="product-info">
          <div class="product-title">3 –ü—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ 2</div>
          <div class="product-description">–ü–æ–ª—É—á–∏—Ç–µ —Ç—Ä–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–≤—å—é –ø–æ —Ü–µ–Ω–µ –¥–≤—É—Ö ‚Äî –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!</div>
          <div class="product-price">400 ‚ÇΩ</div>
          <div style="margin-top:auto">
            <button class="btn btn-outline details-btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
            <button class="btn btn-primary add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>
      </div>
    </div>

    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-btn" id="detailsCloseBtn">&times;</span>
        <img id="modal-img" src="" alt="" style="max-width: 100%; border-radius: 8px; margin-bottom: 10px;">
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <div class="modal-price" id="modal-price"></div>
        <button id="modal-add" class="btn btn-primary" style="margin-top:12px">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>

        <div id="reviews-container" style="margin-top:12px">
          <h3>–û—Ç–∑—ã–≤—ã:</h3>
          <div id="modal-reviews"></div>
          <textarea id="reviewInput" rows="3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤..." style="margin-top:8px"></textarea>
          <button id="submitReview" class="btn btn-accent" style="margin-top:8px">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </div>
      </div>
    </div>

    <div id="cart" class="tab-pane">
      <div class="cart-header">
        <button class="back-btn" onclick="goToTab('catalog')">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="title">–ö–æ—Ä–∑–∏–Ω–∞</div>
        <div class="total" id="total">0,00 ‚ÇΩ</div>
      </div>
      <div class="cart-body" id="cart-body">–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã.</div>
      <div style="padding:10px;">
        <button class="checkout-btn" id="checkout-btn" style="display: none;">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
      </div>
    </div>

    <div id="profile" class="tab-pane">
      <div class="profile-card styled-card">
        <div class="profile-header" style="display: flex; align-items: center; justify-content: space-between; gap: 12px;">
          <div style="flex-shrink: 0;">
            <div style="position: relative; width: 70px; height: 70px; cursor: pointer;" onclick="document.getElementById('avatarModal').classList.remove('hidden')">
              <img id="user-avatar" src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" alt="Avatar"
                   style="width: 70px; height: 70px; border-radius: 50%; object-fit: cover; box-shadow: 0 0 10px rgba(0,0,0,0.4);" />
              <img src="https://cdn-icons-png.flaticon.com/512/84/84380.png" alt="Edit" title="–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"
                   style="position: absolute; bottom: -2px; right: -2px; width: 20px; height: 20px; background: #fff; border-radius: 50%; padding: 2px;" />
            </div>
          </div>
          <div style="text-align: right;">
            <div id="profile-username" style="font-size: 18px; font-weight: bold;">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
            <div id="profile-tg" style="font-size: 14px; color: #ccc;"></div>
            <div id="profile-id" style="font-size: 14px; color: #888;">ID: ‚Äî</div>
          </div>
        </div>
      </div>

      <div class="balance-card styled-card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>–í–∞—à –±–∞–ª–∞–Ω—Å:</div>
          <div id="balance-amount" style="font-weight: bold; font-size: 18px;">0 ‚ÇΩ</div>
        </div>
        <div style="display:flex; gap:8px; margin-top:10px;">
          <button id="topup-btn" class="btn btn-accent">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        </div>
      </div>

      <hr style="margin: 18px 0; border-color: #333;">

      <div class="promocode-card styled-card">
        <div>–ü—Ä–æ–º–æ–∫–æ–¥:</div>
        <input type="text" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" style="margin-top: 8px;">
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="promo-btn" class="btn btn-primary">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div id="promo-message" class="promo-error"></div>
      </div>

      <!-- removed hr and past orders block as requested -->
    </div>

    <div id="avatarModal" class="modal hidden">
      <div class="modal-content">
        <span class="close-btn" onclick="document.getElementById('avatarModal').classList.add('hidden')">&times;</span>
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</h3>
        <p>–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π (PNG/JPG):</p>
        <input type="file" id="avatarUpload" accept="image/png, image/jpeg" />
        <hr style="margin: 15px 0;">
        <p>–ò–ª–∏ –≤—ã–±—Ä–∞—Ç—å –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö:</p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <img src="blue.png" class="preset-avatar" alt="blue" width="60" style="cursor:pointer;border-radius:8px">
          <img src="green.png" class="preset-avatar" alt="green" width="60" style="cursor:pointer;border-radius:8px">
          <img src="purple.png" class="preset-avatar" alt="purple" width="60" style="cursor:pointer;border-radius:8px">
          <img src="red.png" class="preset-avatar" alt="red" width="60" style="cursor:pointer;border-radius:8px">
        </div>
      </div>
    </div>

    <div id="usernameModal" class="modal hidden">
      <div class="modal-content">
        <span id="usernameCloseBtn" class="close-btn">&times;</span>
        <h3>–£–∫–∞–∂–∏—Ç–µ –≤–∞—à Telegram username</h3>
        <p>–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –≤–∞—à –ø–ª–∞—Ç—ë–∂ –∏ –≤—ã—Å–ª–∞—Ç—å —Ç–æ–≤–∞—Ä.</p>
        <input type="text" id="tgUsernameInput" placeholder="@username" style="width: 100%; margin-top: 10px;">
        <div style="margin-top: 15px;">
          <button id="submitUsername" class="btn btn-accent">–û–ö</button>
        </div>
      </div>
    </div>

    <div id="orderModal" class="modal hidden">
      <div class="modal-content" style="background: #142537;">
        <span class="close-btn" id="orderCloseBtn">&times;</span>
        <h2 style="color: #ffffff; font-size: 22px; margin-bottom: 15px; text-align: center;">
          –ö –û–ü–õ–ê–¢–ï: <span id="order-total">... ‚ÇΩ</span>
        </h2>

        <div id="order-items-container" style="margin: 15px 0;"></div>

        <div style="width: 100%; height: auto;">
          <hr style="border: none; border-top: 2px dashed #ffffff; margin: 20px 0;">
        </div>

        <button id="paidButton" class="btn btn-primary" style="margin-top: 25px; width:100%; font-size:16px;">
          –û–ø–ª–∞—Ç–∏—Ç—å
        </button>
      </div>
    </div>

    <!-- ===== Topup modal (modified appearance and disabled confirm) ===== -->
    <div id="topupModal" class="modal hidden" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-labelledby="topupTitle" style="max-width:420px;">
        <span class="close-btn" id="topupCloseBtn">&times;</span>
        <h3 class="topup-title" id="topupTitle">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
        <div class="topup-subtitle">–ü–û–ü–û–õ–ù–ò–¢–¨ –ë–ê–õ–ê–ù–° –í –†–£–ë–õ–Ø–•</div>

        <div style="margin-top:8px;">
          <input id="topupAmount" class="topup-amount-input" type="number" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è" />
          <div class="topup-presets" style="margin-top:10px;">
            <button class="preset-btn" data-amount="100">+100 ‚ÇΩ</button>
            <button class="preset-btn" data-amount="300">+300 ‚ÇΩ</button>
            <button class="preset-btn" data-amount="500">+500 ‚ÇΩ</button>
          </div>

          <div class="topup-footer">
            <!-- This button is intentionally disabled ‚Äî clicking it will do nothing (per your request). -->
            <button id="confirmTopup" class="btn btn-primary disabled" style="width:100%;" disabled>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ===== end topup modal ===== -->

  </div>

  <div class="bottom-nav" id="bottomNav" aria-hidden="false">
    <button class="active" data-tab="catalog"><img src="home.svg" alt="" style="width:20px;height:20px"><span>–ö–∞—Ç–∞–ª–æ–≥</span></button>
    <button data-tab="cart"><img src="cart.svg" alt="" style="width:20px;height:20px"><span>–ö–æ—Ä–∑–∏–Ω–∞</span></button>
    <button data-tab="profile"><img src="profile.svg" alt="" style="width:20px;height:20px"><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>

  <div id="toast"></div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Telegram readiness
  try { Telegram.WebApp?.ready?.(); Telegram.WebApp?.expand?.(); } catch(e){/*ignore*/}

  // elements
  const toast = document.getElementById('toast');
  const bottomNav = document.getElementById('bottomNav');
  const totalText = document.getElementById('total');
  const cartBody = document.getElementById('cart-body');
  const modal = document.getElementById('modal');
  const checkoutBtn = document.getElementById('checkout-btn');
  const modalReviews = document.getElementById('modal-reviews');
  const reviewInput = document.getElementById('reviewInput');
  const submitReview = document.getElementById('submitReview');
  const tabContent = document.getElementById('tabContent');
  const headerEl = document.getElementById('appHeader');

  // topup modal elements
  const topupModal = document.getElementById('topupModal');
  const topupCloseBtn = document.getElementById('topupCloseBtn');
  const topupAmountInput = document.getElementById('topupAmount');
  const presetButtons = Array.from(document.querySelectorAll('.preset-btn'));
  const confirmTopupBtn = document.getElementById('confirmTopup');

  // state
  let cart = JSON.parse(localStorage.getItem('cart_v1') || '{}');
  let total = parseFloat(localStorage.getItem('cart_total_v1') || '0');
  let currentProduct = '';
  let checkoutAppliedPromo = null;
  let checkoutDiscountAmount = 0;
  let telegramUser = null;
  try { telegramUser = (Telegram.WebApp && Telegram.WebApp.initDataUnsafe) ? Telegram.WebApp.initDataUnsafe.user : null; } catch(e){ telegramUser = null; }

  // profile basic data
  const storedUsername = localStorage.getItem('tg_username');

  // username and avatar elements - read live inside applyProfileInfo
  function applyProfileInfo() {
    const profileNameEl = document.getElementById('profile-username');
    const profileTgEl = document.getElementById('profile-tg');
    const profileIdEl = document.getElementById('profile-id');
    const userAvatarEl = document.getElementById('user-avatar');

    // read avatar fresh from localStorage each time
    const storedAvatar = localStorage.getItem('customAvatar');

    // topmost should be first_name + last_name from Telegram if available; otherwise fallback to storedUsername (without @) or placeholder
    let fullName = '';
    if (telegramUser) {
      const fn = telegramUser.first_name || '';
      const ln = telegramUser.last_name || '';
      fullName = (fn + (ln ? (' ' + ln) : '')).trim();
    }
    if (!fullName && localStorage.getItem('tg_username')) {
      const su = localStorage.getItem('tg_username');
      fullName = su.startsWith('@') ? su.substring(1) : su;
    }
    if (!fullName) fullName = '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';

    // profile handle (tg) should be @username if exists (from telegramUser.username or storedUsername)
    let handle = '';
    if (telegramUser && telegramUser.username) handle = '@' + telegramUser.username;
    else if (localStorage.getItem('tg_username')) handle = localStorage.getItem('tg_username').startsWith('@') ? localStorage.getItem('tg_username') : ('@' + localStorage.getItem('tg_username'));

    const idText = 'ID: ' + (telegramUser && telegramUser.id ? telegramUser.id : '‚Äî');

    profileNameEl.textContent = fullName;
    profileTgEl.textContent = handle || '';
    profileIdEl.textContent = idText;

    if (storedAvatar) {
      userAvatarEl.src = storedAvatar;
    }
  }

  applyProfileInfo();

  // visual helper
  function showToast(message, ms = 1800) {
    toast.textContent = message;
    toast.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(()=> toast.classList.remove('show'), ms);
  }

  // update CSS variables for heights
  function updateHeights() {
    const headerH = Math.max(56, Math.round(headerEl.getBoundingClientRect().height));
    const bottomH = Math.max(64, Math.round(bottomNav.getBoundingClientRect().height + 12));
    document.documentElement.style.setProperty('--header-h', headerH + 'px');
    document.documentElement.style.setProperty('--bottom-nav-h', bottomH + 'px');
    tabContent.style.height = `calc(100vh - ${headerH}px - 24px)`;
  }
  updateHeights();
  window.addEventListener('resize', updateHeights);

  // centralized tab switcher (–∑–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫–∏, —Å–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å–∫—Ä–æ–ª–ª–∞)
  window.goToTab = function(id) {
    document.querySelectorAll('.tab-pane').forEach(t => t.classList.remove('active'));
    const target = document.getElementById(id);
    if (target) target.classList.add('active');

    // set active class on bottom nav buttons (query fresh)
    document.querySelectorAll('.bottom-nav button').forEach(b => b.classList.remove('active'));
    const navBtn = document.querySelector(`.bottom-nav button[data-tab="${id}"]`);
    if (navBtn) navBtn.classList.add('active');

    // close all modals and allow body scroll
    document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
    document.body.style.overflow = '';

    if (tabContent) tabContent.scrollTop = 0;
  };

  // bottom nav: use delegation to avoid stale NodeList issues
  bottomNav.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-tab]');
    if (!btn) return;
    const tab = btn.dataset.tab;
    if (!tab) return;
    goToTab(tab);
  });

  // cart functions
  function saveCart() {
    localStorage.setItem('cart_v1', JSON.stringify(cart));
    localStorage.setItem('cart_total_v1', total.toFixed(2));
  }

  function addToCart(name, price, image) {
    if (!cart[name]) cart[name] = { name, price: parseFloat(price), image, count: 0 };
    cart[name].count++;
    total = parseFloat((total + parseFloat(price)).toFixed(2));
    saveCart();
    updateCartDisplay();
    showToast(`üõí ¬´${name}¬ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);
    // –ü–µ—Ä–µ–π—Ç–∏ —Å—Ä–∞–∑—É –≤ –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–ø–æ –∑–∞–ø—Ä–æ—Å—É)
    goToTab('cart');
  }

  function updateCartDisplay() {
    cartBody.innerHTML = '';
    const keys = Object.keys(cart || {});
    if (!keys.length) {
      cartBody.textContent = '–ó–¥–µ—Å—å –±—É–¥—É—Ç –≤–∞—à–∏ —Ç–æ–≤–∞—Ä—ã.';
      totalText.textContent = '0,00 ‚ÇΩ';
      checkoutBtn.style.display = 'none';
      return;
    }

    keys.forEach(k => {
      const item = cart[k];
      const div = document.createElement('div');
      div.className = 'product-card';
      div.innerHTML = `
        <img src="${item.image}" alt="">
        <div class="product-info">
          <div class="product-title">${item.name}</div>
          <div class="product-price">${item.price.toFixed(2)} ‚ÇΩ √ó ${item.count}</div>
          <div class="cart-controls" style="margin-top:8px">
            <button class="btn btn-outline dec btn-small" data-name="${item.name}">‚àí</button>
            <button class="btn btn-outline inc btn-small" data-name="${item.name}">+</button>
          </div>
        </div>`;
      cartBody.appendChild(div);
    });

    totalText.textContent = total.toFixed(2) + ' ‚ÇΩ';
    checkoutBtn.style.display = 'block';

    // attach controls (re-query from current DOM)
    cartBody.querySelectorAll('.inc').forEach(btn => {
      btn.onclick = () => {
        const name = btn.dataset.name;
        cart[name].count++;
        total = parseFloat((total + cart[name].price).toFixed(2));
        saveCart();
        updateCartDisplay();
      };
    });
    cartBody.querySelectorAll('.dec').forEach(btn => {
      btn.onclick = () => {
        const name = btn.dataset.name;
        if (!cart[name]) return;
        cart[name].count--;
        total = parseFloat((total - cart[name].price).toFixed(2));
        if (cart[name].count <= 0) delete cart[name];
        saveCart();
        updateCartDisplay();
      };
    });
  }

  updateCartDisplay();

  // attach add buttons (static elements) and details buttons
  function attachProductButtons() {
    document.querySelectorAll('.add-btn').forEach(btn => {
      if (btn._attached) return;
      btn._attached = true;
      btn.addEventListener('click', () => {
        const card = btn.closest('.product-card');
        const name = card.dataset.name;
        const price = parseFloat(card.dataset.price);
        const image = card.dataset.image;
        addToCart(name, price, image);

        // feedback
        btn.disabled = true;
        const original = btn.textContent;
        btn.textContent = '‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!';
        btn.classList.add('pulse-animate');
        btn.style.background = 'linear-gradient(90deg, #8cff00, #ff5a75)';

        setTimeout(() => {
          btn.textContent = original;
          btn.disabled = false;
          btn.classList.remove('pulse-animate');
          btn.style.background = '';
        }, 1200);
      });
    });

    document.querySelectorAll('.details-btn').forEach(btn => {
      if (btn._attachedDetails) return;
      btn._attachedDetails = true;
      btn.addEventListener('click', () => {
        const card = btn.closest('.product-card');
        document.getElementById('modal-img').src = card.dataset.image;
        document.getElementById('modal-title').textContent = card.dataset.name;
        document.getElementById('modal-desc').textContent = card.dataset.desc;
        document.getElementById('modal-price').textContent = parseFloat(card.dataset.price).toFixed(2) + ' ‚ÇΩ';
        document.getElementById('modal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        currentProduct = card.dataset.name;
        loadReviews();
        document.getElementById('modal-add').onclick = () => {
          addToCart(card.dataset.name, +card.dataset.price, card.dataset.image);
          document.getElementById('modal').classList.add('hidden');
          document.body.style.overflow = '';
        };
      });
    });
  }
  attachProductButtons();

  document.getElementById('detailsCloseBtn')?.addEventListener('click', () => { document.getElementById('modal').classList.add('hidden'); document.body.style.overflow = ''; });
  window.addEventListener('click', (e) => { if (e.target.classList && e.target.classList.contains('modal')) { e.target.classList.add('hidden'); document.body.style.overflow = ''; } });

  // Reviews storage
  function loadReviews() {
    const key = `reviews_${currentProduct}`;
    const reviews = JSON.parse(localStorage.getItem(key) || '[]');
    modalReviews.innerHTML = '';
    if (!reviews.length) {
      modalReviews.innerHTML = '<p>–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
    } else {
      reviews.forEach(r => {
        const div = document.createElement('div');
        div.className = 'review-item';
        div.style.marginTop = '10px';
        div.style.borderTop = '1px dashed rgba(255,255,255,0.04)';
        div.style.paddingTop = '8px';
        div.innerHTML = `<span style="color:var(--neon-yellow); font-weight:700">${r.name}</span>: ${r.text}`;
        modalReviews.appendChild(div);
      });
    }
  }

  submitReview?.addEventListener('click', () => {
    const text = reviewInput.value.trim();
    if (!text) return alert('–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤!');
    const name = telegramUser ? (`${telegramUser.first_name || ''} ${(telegramUser.last_name || '').trim()}`.trim() || (telegramUser.username ? '@'+telegramUser.username : '–ê–Ω–æ–Ω–∏–º')) : (localStorage.getItem('tg_username') || '–ê–Ω–æ–Ω–∏–º');
    const key = `reviews_${currentProduct}`;
    const reviews = JSON.parse(localStorage.getItem(key) || '[]');
    reviews.push({ name, text });
    localStorage.setItem(key, JSON.stringify(reviews));
    reviewInput.value = '';
    loadReviews();
    showToast('–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤!');
  });

  // Checkout
  checkoutBtn?.addEventListener('click', () => {
    const container = document.getElementById('order-items-container');
    container.innerHTML = '';
    Object.values(cart).forEach(item => {
      const div = document.createElement('div');
      div.className = 'product-card';
      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div class="product-info">
          <div class="product-title">${item.name}</div>
          <div class="product-description">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${item.count}</div>
          <div class="product-price">${item.price.toFixed(2)} ‚ÇΩ √ó ${item.count} = ${(item.price * item.count).toFixed(2)} ‚ÇΩ</div>
        </div>
      `;
      container.appendChild(div);
    });

    document.getElementById('order-total').textContent = total.toFixed(2) + ' ‚ÇΩ';
    checkoutAppliedPromo = null;
    checkoutDiscountAmount = 0;
    document.getElementById('orderModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  document.getElementById('orderCloseBtn')?.addEventListener('click', () => { document.getElementById('orderModal').classList.add('hidden'); document.body.style.overflow = ''; });

  // Payment
  document.getElementById('paidButton')?.addEventListener('click', () => {
    const usernameSaved = localStorage.getItem('tg_username');
    if (!usernameSaved && (!telegramUser || !telegramUser.username)) {
      document.getElementById('usernameModal').classList.remove('hidden');
      return;
    }

    const amountToPay = Math.round(total * 100);

    if (!Telegram.WebApp || !Telegram.WebApp.openInvoice) {
      showToast("‚ö†Ô∏è Telegram WebApp API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");
      return;
    }

    if (amountToPay <= 0) {
      showToast("–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0");
      return;
    }

    const payload = {
      title: "–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞",
      description: "–ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ Dutroux Sell",
      payload: "order_" + Date.now(),
      provider_token: "1754495953908DEMO",
      currency: "RUB",
      prices: [
        { label: "–¢–æ–≤–∞—Ä—ã", amount: amountToPay }
      ],
      need_name: true,
      photo_url: "logo.png",
      photo_width: 512,
      photo_height: 512,
      is_flexible: false
    };

    try {
      Telegram.WebApp.openInvoice(payload, function (status) {
        if (status === 'paid' || status === 'success') {
          showToast("‚úÖ –û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞!");
          // save order history
          saveOrderHistory({
            id: payload.payload,
            items: cart,
            total: (amountToPay / 100).toFixed(2),
            date: new Date().toISOString()
          });
          // clear cart
          cart = {};
          total = 0;
          checkoutAppliedPromo = null;
          checkoutDiscountAmount = 0;
          saveCart();
          updateCartDisplay();
          document.getElementById('orderModal').classList.add('hidden');
          document.body.style.overflow = '';
        } else {
          showToast("‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
          document.body.style.overflow = '';
        }
      });
    } catch (err) {
      console.error(err);
      showToast("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –æ–ø–ª–∞—Ç—ã ‚Äî —Å–º. –∫–æ–Ω—Å–æ–ª—å");
    }
  });

  // username modal handlers
  document.getElementById('usernameCloseBtn')?.addEventListener('click', () => {
    document.getElementById('usernameModal').classList.add('hidden');
  });
  document.getElementById('submitUsername')?.addEventListener('click', () => {
    const val = (document.getElementById('tgUsernameInput').value || '').trim();
    if (!val) { showToast('–í–≤–µ–¥–∏—Ç–µ username'); return; }
    const normalized = val.startsWith('@') ? val : ('@' + val);
    localStorage.setItem('tg_username', normalized);
    showToast('Username —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
    document.getElementById('usernameModal').classList.add('hidden');
    applyProfileInfo();
  });

  // avatar upload & presets
  document.getElementById('avatarUpload')?.addEventListener('change', (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) { alert('–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'); return; }
    const reader = new FileReader();
    reader.onload = function(ev) {
      const dataUrl = ev.target.result;
      localStorage.setItem('customAvatar', dataUrl);
      document.getElementById('user-avatar').src = dataUrl;
      showToast('–ê–≤–∞—Ç–∞—Ä —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
      document.getElementById('avatarModal').classList.add('hidden');
      applyProfileInfo();
    };
    reader.readAsDataURL(file);
  });

  document.querySelectorAll('.preset-avatar').forEach(img => {
    img.addEventListener('click', () => {
      const src = img.src;
      localStorage.setItem('customAvatar', src);
      document.getElementById('user-avatar').src = src;
      showToast('–ê–≤–∞—Ç–∞—Ä –≤—ã–±—Ä–∞–Ω');
      document.getElementById('avatarModal').classList.add('hidden');
      applyProfileInfo();
    });
  });

  // balance management (now using modal)
  function getBalance() { return parseFloat(localStorage.getItem('balance_v1') || '0'); }
  function setBalance(v) { localStorage.setItem('balance_v1', parseFloat(v).toFixed(2)); document.getElementById('balance-amount').textContent = parseFloat(v).toFixed(2) + ' ‚ÇΩ'; }
  setBalance(getBalance());

  // Open topup modal (replace previous prompt-based flow)
  document.getElementById('topup-btn')?.addEventListener('click', () => {
    // reset input and presets
    topupAmountInput.value = '';
    presetButtons.forEach(b => b.classList.remove('active'));
    topupModal.classList.remove('hidden');
    topupModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    // focus input after small delay so mobile keyboard opens smoothly
    setTimeout(()=> topupAmountInput.focus(), 120);
  });

  // close topup modal
  topupCloseBtn?.addEventListener('click', () => {
    topupModal.classList.add('hidden');
    topupModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  });

  // preset buttons
  presetButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const amount = parseFloat(btn.dataset.amount || '0');
      if (isNaN(amount) || amount <= 0) return;
      topupAmountInput.value = amount;
      presetButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // IMPORTANT: confirmTopupBtn intentionally disabled ‚Äî clicking does nothing.
  if (confirmTopupBtn) {
    // ensure it's disabled visually and functionally
    confirmTopupBtn.disabled = true;
    confirmTopupBtn.classList.add('disabled');
    confirmTopupBtn.onclick = (e) => {
      // explicit no-op to prevent accidental form submission
      e.preventDefault();
      return false;
    };
  }

  // order history save (kept for internal use but the UI block was removed)
  function saveOrderHistory(order) {
    const arr = JSON.parse(localStorage.getItem('order_history_v1') || '[]');
    arr.unshift(order);
    localStorage.setItem('order_history_v1', JSON.stringify(arr));
    // no render here ‚Äî UI for history removed per your request
  }

  // small UX: block page scroll when modal open handled above; prevent page native scroll bleed
  tabContent.addEventListener('wheel', function (e) {
    if (!e.deltaY) return;
    const st = tabContent.scrollTop;
    const max = tabContent.scrollHeight - tabContent.clientHeight;
    if ((st <= 0 && e.deltaY < 0) || (st >= max && e.deltaY > 0)) { e.preventDefault(); }
  }, { passive: false });

  let touchStartY = 0;
  tabContent.addEventListener('touchstart', function (e) { if (e.touches && e.touches.length) touchStartY = e.touches[0].clientY; }, { passive: true });
  tabContent.addEventListener('touchmove', function (e) {
    if (!e.touches || !e.touches.length) return;
    const currentY = e.touches[0].clientY;
    const dy = touchStartY - currentY;
    const st = tabContent.scrollTop;
    const max = tabContent.scrollHeight - tabContent.clientHeight;
    if ((st <= 0 && dy < 0) || (st >= max && dy > 0)) { e.preventDefault(); }
  }, { passive: false });

  // initial attach for dynamic items and re-attach after DOM changes if needed
  attachProductButtons();

  // make sure profile shows telegram user if available (but don't overwrite manually saved)
  if (telegramUser && !localStorage.getItem('tg_username')) {
    if (telegramUser.username) localStorage.setItem('tg_username', '@' + telegramUser.username);
    applyProfileInfo();
  }

  // populate username input with existing value when opening modal
  document.querySelectorAll('#usernameModal, #avatarModal').forEach(m => {
    m.addEventListener('click', (e) => {
      if (m.classList.contains('hidden')) return;
      const tgInput = document.getElementById('tgUsernameInput');
      if (tgInput) {
        const cur = localStorage.getItem('tg_username') || (telegramUser && telegramUser.username ? ('@' + telegramUser.username) : '');
        tgInput.value = cur;
      }
    });
  });

  // small protection: keep header heights updated when fonts/images load
  window.addEventListener('load', updateHeights);

});
</script>

</body>
</html>
